#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ([2.69])
AC_INIT([orpara], [0.1.0], [kmzhou4@yaho.com])
AM_INIT_AUTOMAKE([-Wall -Werror])
AC_CONFIG_SRCDIR([src/interval.cpp])
AC_CONFIG_HEADERS([config.h])
LT_PREREQ([2.4])
LT_INIT([dlopen])
AC_CONFIG_MACRO_DIR([m4])

# Checks for programs.
AC_PROG_CXX
AC_PROG_CC
AC_PROG_INSTALL

AC_LANG([C++])

# Checks for libraries.
# FIXME: Replace `main' with a function in `-lgtest':
AC_CHECK_LIB([gtest], [main])
# FIXME: Replace `main' with a function in `-lgtest_main':
AC_CHECK_LIB([gtest_main], [main])
# FIXME: Replace `main' with a function in `-lkemin':
AC_CHECK_LIB([kemin], [main])

# Check pthread : Replace `main' with a function in `-lpthread':
AC_SEARCH_LIBS([pthread_create], [pthread])

# bamtools lib check, this will check both header and lib
save_LIBS=$LIBS
LIBS="$LIBS -lbamtools"
AC_LINK_IFELSE(
		[AC_LANG_PROGRAM([#include <api/BamReader.h>],  [BamTools::BamReader dummy])],
		[HAVE_BAMTOOLS=1],
		[AC_MSG_WARN([libbamtools is not installed])])
LIBS=$save_LIBS

# boost lib check
save_LIBS=$LIBS
LIBS="$LIBS -lboost_program_options"
AC_LINK_IFELSE(
		[AC_LANG_PROGRAM([#include <boost/program_options/parsers.hpp>],  [boost::program_option::option dummy])],
		[HAVE_BOOST=1],
		[AC_MSG_WARN([boost is not installed])])
LIBS=$save_LIBS

# Checks for header files.
AC_CHECK_HEADERS([string.h])
save_CXXFLAGS = $CXXFLAGS
CXXFLAGS="$CXXFLAGS -std=c++11 -I/usr/local/include/bamtools"
AC_CHECK_HEADERS([api/BamReader.h], [bamtools_found=yes], [AC_MSG_ERROR([Unable to find bambools header])])
CXXFLAGS=$save_CXXFLAGS

# Checks for typedefs, structures, and compiler characteristics.
AC_CHECK_HEADER_STDBOOL
AC_TYPE_INT8_T
AC_TYPE_SIZE_T

# Checks for library functions.
AC_CHECK_FUNCS([floor mkdir pow sqrt strchr strstr])

AC_CONFIG_FILES([Makefile
                 src/Makefile
                 src/seqaln/Makefile
                 src/seqaln/blast/Makefile
                 src/seqana/Makefile
                 src/seqana/cdna/Makefile
                 src/seqana/fasta/Makefile
                 src/seqana/seqsep/Makefile
                 src/seqconv/Makefile
                 src/test/src/Makefile])
AC_OUTPUT
